<div class="courses-container">
    <div class="header">
        <h1>Courses Management</h1>
        <p class="subtitle">Approve and manage all courses</p>
    </div>

    <!-- Filters -->
    <div class="filters">
        <mat-form-field appearance="outline">
            <mat-label>Search Courses</mat-label>
            <input matInput (keyup)="applyFilter($event)" placeholder="Course Title" #input>
            <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <mat-form-field appearance="outline">
            <mat-label>Filter by Status</mat-label>
            <mat-select [(value)]="statusFilter" (selectionChange)="applyStatusFilter()">
                <mat-option value="All">All Status</mat-option>
                <mat-option value="Draft">Draft</mat-option>
                <mat-option value="Pending">Pending</mat-option>
                <mat-option value="Approved">Approved</mat-option>
                <mat-option value="Rejected">Rejected</mat-option>
            </mat-select>
        </mat-form-field>
    </div>

    <!-- Table -->
    <div class="mat-elevation-z8 table-container">
        <table mat-table [dataSource]="dataSource" matSort>

            <ng-container matColumnDef="title">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Course Title </th>
                <td mat-cell *matCellDef="let course"> {{course.title}} </td>
            </ng-container>

            <ng-container matColumnDef="instructor">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Instructor </th>
                <td mat-cell *matCellDef="let course"> {{course.instructorName}} </td>
            </ng-container>

            <ng-container matColumnDef="category">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Category </th>
                <td mat-cell *matCellDef="let course"> {{course.category}} </td>
            </ng-container>

            <ng-container matColumnDef="level">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Level </th>
                <td mat-cell *matCellDef="let course"> {{course.level}} </td>
            </ng-container>

            <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Status </th>
                <td mat-cell *matCellDef="let course">
                    <mat-chip
                        [color]="course.status === 'Approved' ? 'primary' : course.status === 'Pending' ? 'accent' : 'warn'">
                        {{course.status}}
                    </mat-chip>
                </td>
            </ng-container>

            <ng-container matColumnDef="enrolledCount">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Enrolled </th>
                <td mat-cell *matCellDef="let course"> {{course.enrolledCount}} </td>
            </ng-container>

            <ng-container matColumnDef="createdOn">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Created On </th>
                <td mat-cell *matCellDef="let course"> {{course.createdOn | date:'short'}} </td>
            </ng-container>

            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef> Actions </th>
                <td mat-cell *matCellDef="let course">
                    <!-- View button - always visible -->
                    <button mat-icon-button color="primary" [routerLink]="['/courses', course.id]"
                        matTooltip="View Course">
                        <mat-icon>visibility</mat-icon>
                    </button>

                    <!-- Approve, Reject, Delete - only for Pending courses -->
                    <ng-container *ngIf="course.status === 'Pending'">
                        <button mat-icon-button color="accent" (click)="approveCourse(course)"
                            matTooltip="Approve Course">
                            <mat-icon>check_circle</mat-icon>
                        </button>
                        <button mat-icon-button color="warn" (click)="rejectCourse(course)" matTooltip="Reject Course">
                            <mat-icon>cancel</mat-icon>
                        </button>
                    </ng-container>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

            <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell" colspan="8">No courses found</td>
            </tr>
        </table>

        <mat-paginator [pageSizeOptions]="[10, 25, 50]" aria-label="Select page of courses"></mat-paginator>
    </div>
</div>